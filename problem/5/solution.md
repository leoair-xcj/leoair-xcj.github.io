将树轻重链剖分，然后用线段树维护重链，支持区间修改和区间查询。

对于线段树上的每个区间，我们维护其左端点的类型、右端点的类型以及整个区间所代表的点的类型个数。将两个区间信息合并时，要注意当左区间右端点的类型与右区间左端点的类型相同时要将答案减一。

对于从 $x,y$ 分别跳重链到 $LCA$ 时的答案计算，我们需记录前一次该点跳重链时重链的第一个点的类型，这样就可以判断两链相连两点的类型相同的情况。

注意到区间修改后若没有用到则为浪费，所以我们可以用懒标记下放来维护区间修改。

在跳重链时注意理清两个点先跳的重链和后跳的重链的对应关系。
