若我们将每个骑士看作一个点，并将其与自己讨厌的骑士连一条有向边，则本题就可以转化为求最大独立集。

由于该图有 $n$ 条边，因此图上可能会出现环。我们考虑断环，对于环上任意两个相邻的点 $u,v$，显然 $u,v$ 中要么两个都不选，要么只选一个。因此我们可以强制不选 $u$，$v$ 任意，或者强制不选 $v$，$u$ 任意。这样可以使原来的环变为树，用树形dp求最大独立集。

注意数据范围，记得开 $\text{long long}$
