由于每个软件可能都有依赖，因此软件间的依赖关系可能构成一个环。显然，若关系出现环，则要么关系构成环的软件都选，要么都不选。因此我们根据软件间的依赖关系，即从 $d_i$ 到 $i$ 连一条边，得到一个起始点为 $0$ 的有向图。接着用Tarjan进行有向图缩点（缩完点后要将每个强连通分量的价值和与占用容量和记录在缩点后的新点上），得到DAG，即一棵有根树，可以通过树形背包求解最大价值。

设 $f_{x,i,j}$ 表示以 $x$ 为根的前 $i$ 个子树，分配容量大小为 $j$ 的最大价值。

转移：$f_{x,i,j}=\max(f_{x,i,j},\max\limits_{y\in son_x}(f_{x,i-1,j-k}+f_{y,sub_y,j-k}))(k\in[0,j-a_x])$（$sub_y$ 表示 $y$ 的子树个数，$k$ 的上限为 $j-a_x$，因为若选择 $x$ 的子树，必须选 $x$）

可以发现，$f$ 数组的第二维只与上一次使用时有关，因此可以优化掉（注意倒序枚举）。

优化后的转移：$f_{x,j}=\max(f_{x,j},\max\limits_{y\in son_x}(f_{x,j-k}+f_{y,j-k}))(k\in[0,j-a_x])$

初始化：$f_{x,i}=b_x(i\in{[a_x,m]})$

目标状态：$f_{0,m}$
